plugins {
    id 'org.springframework.boot' version '2.1.1.RELEASE'
    id "io.github.ddimtirov.codacy" version "0.1.0"
}

apply plugin: 'java'
apply plugin: 'maven-publish'
apply plugin: 'eclipse'
apply plugin: 'idea'
apply plugin: "jacoco"
apply plugin: 'io.spring.dependency-management'

apply from:   'checkerframework.gradle'

wrapper{
    gradleVersion = '4.8'
    distributionType = Wrapper.DistributionType.BIN
}

bootJar {
    mainClassName = 'uk.ac.ebi.ena.webin.cli.WebinCli'
}

group = 'uk.ac.ebi.ena.webin-cli'
ext.version_base = '1.6.0'
version = version_base
sourceCompatibility = '1.8'
targetCompatibility = '1.8'

// ext.webinCliCodacyProjectToken =

repositories {
    mavenLocal()
    maven { url "http://ena-dev:8081/artifactory/all" }
}

configurations.all {
	
	if( !hasProperty( 'artifactoryUsername' ) )
		project.ext.properties.artifactoryUsername = ''
	else
		project.ext.properties.artifactoryUsername = artifactoryUsername;
		
	if( !hasProperty( 'artifactoryPassword' ) )
		project.ext.properties.artifactoryPassword = ''
	else
	 	project.ext.properties.artifactoryPassword = artifactoryPassword;
}


test {
	jvmArgs "-Dfile.encoding=UTF-8"
	maxHeapSize = '4G'

	if( System.env.webin_cli_password ) {
      	environment 'webin-cli-password', System.env.webin_cli_password
    } else {
    	environment 'webin-cli-password', webinCliPassword
    }

	if( System.env.webin_cli_username ) {
      	environment 'webin-cli-username', System.env.webin_cli_username
    } else {
    	environment 'webin-cli-username', webinCliUsername
    }
}


task printWebinTestCredentials {
    doLast {
        println 'webinCliUsername: ' + webinCliUsername
        println 'webinCliPassword: ' + webinCliPassword
    }
}

dependencies {
    implementation("commons-net:commons-net:3.4")
    implementation group: 'com.beust', name: 'jcommander', version: '1.72'
    implementation(group: 'uk.ac.ebi.ena.sequence', name: 'embl-api-ff', version: 'submissioninterface-1.1.11')
    implementation(group: 'uk.ac.ebi.ena.sequence', name: 'embl-api-core', version: 'submissioninterface-1.1.11')
    implementation(group: 'uk.ac.ebi.ena.sequence', name: 'embl-api-validator', version: 'submissioninterface-1.1.11')
    implementation("org.jdom:jdom:2.0.2")
    implementation( group: 'uk.ac.ebi', name: 'ena-fastq-validator', version: '1.1.1' )
    implementation( group: 'uk.ac.ebi.ena', name: 'ena-cram-processing-tools', version: '1.1.0' );
    implementation( group: 'com.github.samtools', name: 'htsjdk', version: '2.15.0' )
    implementation( group: 'com.google.guava', name: 'guava', version: '26.0-jre' )


    implementation('org.springframework.boot:spring-boot-starter')
    implementation('org.springframework.boot:spring-boot-starter-web')
    // implementation("org.projectlombok:lombok:1.18.4")
    testImplementation('org.springframework.boot:spring-boot-starter-test')
    testImplementation('org.assertj:assertj-core:3.11.1')
    testImplementation('org.mockito:mockito-core:2.23.4')
}

configurations.all {
    resolutionStrategy {
      force "commons-net:commons-net:3.4"
    }
}

task sourceJar(type: Jar) { 
	from sourceSets.main.allJava 
	
}


tasks.withType(JavaCompile) {
    options.encoding = 'UTF-8'
}

publishing {
    publications {
        mavenJava(MavenPublication) {
            from components.java
            artifact sourceJar { classifier "sources" }
        }
    }
    repositories {
        maven {
            credentials {
                username project.ext.properties.artifactoryUsername
                password project.ext.properties.artifactoryPassword
            }
            url "http://ena-dev:8081/artifactory/libs-release-local"
        }
    }
}



codacy {
    // Codacy project token https://support.codacy.com/hc/en-us/articles/207279819-Coverage
    // projectToken = webinCliCodacyProjectToken
}
